{"componentChunkName":"component---src-templates-blogs-post-js","path":"/blog/2021/strategy-design-pattern-with-di/","result":{"data":{"site":{"siteMetadata":{"title":"David Kröll"}},"markdownRemark":{"id":"2aa290a2-d1ac-5f97-8d7e-31d25b4a54be","excerpt":"The strategy pattern is a behavioral design pattern which\nlets you select an algorithm at runtime.\nRather than implementing it directly, you…","rawMarkdownBody":"\n\nThe strategy pattern is a behavioral design pattern which\nlets you select an algorithm at runtime.\nRather than implementing it directly, you will end up having multiple code parts\nwith the same interface, which are completely interchangeable.\nThis design pattern was invented by the famous GoF back in the '90.\n\nIn this article I'd like to show a different implementation of it\nusing dependency injection and discuss the pros and cons\nin contrast to the \"classic\" implementation.\n\n\n### Outline\n* What is the strategy design pattern?\n* What are the usages of it?\n* How to implement it in a classic way\n* How to implement it with dependency injection\n\n> **Remark**: The full code is available at [GitHub](https://github.com/davidkroell/davidkroell.com/tree/main/content/blogposts/2021/strategy-design-pattern-with-di/src)\n\n## What is the strategy design pattern?\n\nImagine you are running a restaurant which provides service at the tables\nand also meals for delivery.\nAs a result, you have different efforts\nand costs depending on where your customer likes to eat.\n\nAt the restaurant you have to wash dishes,\nserve plates to the table and clean them up.\n\nWhen a customer likes to have his menu for delivery, you\nhave to package it and deliver it to your customers house.\n\nTherefore, you maybe have two different pricing policies:\n* Eating at the restaurant\n* Takeaway and delivery\n* ... maybe many more in the future\n\nThis is a perfect use case for the strategy design pattern.\n\n> You can find a more detailed explanation of the strategy design pattern -\nalso with examples in various languages - at https://refactoring.guru/.\nThere are also other design patterns explained in much detail at this site.\nI totally recommend it to everyone to give it a try.\n\n## Implementation without DI\n\nLet me quickly break down this design pattern in\nit's parts so that cou can more easily understand it.\n\n![The strategy design pattern flow](./strategy-flow.png)\n\nContext object\n* Holds a reference to all the strategies\n* Executes them via the same interface\n\n```csharp\npublic class BillCalculatorContext\n{\n\tprivate readonly Dictionary<string, IBillCalculator> _strategies;\n\n\tpublic BillCalculatorContext(BillCalculatorRestaurantStrategy restaurantStrategy,\n\t\t\t\t\t\t\t\t BillCalculatorDeliveryStrategy deliveryStrategy)\n\t{\n\t\t// all the available strategies\n\t\t_strategies = new Dictionary<string, IBillCalculator>\n\t\t{\n\t\t\t{\"restaurant\", restaurantStrategy},\n\t\t\t{\"delivery\", deliveryStrategy}\n\t\t};\n\t}\n\n\tpublic decimal GetTotalPrice(string strategy, ICollection<Order> orders)\n\t{\n\t\tif(_strategies.TryGetValue(strategy, out var billCalculator))\n\t\t{\n\t\t\t// the call to the strategy\n\t\t\treturn billCalculator.GetTotalPrice(orders);\n\t\t}\n\n\t\tthrow new NotSupportedException($\"Strategy {strategy} is not supported\");\n\t}\n}\n```\n\nStrategy client:\n* Decides which strategy to use\n* Calls the context object\n\n```csharp\npublic static void Run(bool isDelivery, ICollection<Order> orders)\n{\n\tvar billCalculatorContext = new BillCalculatorContext(\n\t\tnew BillCalculatorRestaurantStrategy(),\n\t\tnew BillCalculatorDeliveryStrategy());\n\n\tvar strategy = isDelivery\n\t\t? \"delivery\"\n\t\t: \"restaurant\";\n\t\n\tvar price = billCalculatorContext.GetTotalPrice(strategy, orders);\n\tConsole.WriteLine($\"Total bill is: {price} - calculated with {nameof(StartupClassic)}\");\n}\n```\n\n> A complete explanation with samples can be found here: [Strategy design pattern](https://refactoring.guru/design-patterns/strategy)\n\n\n## Implementation with DI\n\n> Make sure to understand dependency injection first: https://dev.to/ankitutekar/dependency-injection-the-what-and-whys-240m\n\nProceeding from the classic implementation,\nthe so-called `Context object` is now the DI-container.\n\nThe strategy decision is handled via this container,\ndepending on what implementation is supplied in the configuration.\n\nWhen someone resolves the desired interface you automatically get\nthe correct implementation.\n\n```csharp\n// decision is made based on the value of isDelivery\npublic static void Run(bool isDelivery, ICollection<Order> orders)\n{\n\tvar serviceCollection = new ServiceCollection();\n\n\tif (isDelivery)\n\t{\n\t\tserviceCollection.AddSingleton<IBillCalculator, BillCalculatorDeliveryStrategy>();\n\t}\n\telse\n\t{\n\t\tserviceCollection.AddSingleton<IBillCalculator, BillCalculatorRestaurantStrategy>();\n\t}\n\n\tvar serviceProvider = serviceCollection.BuildServiceProvider();\n\tvar billCalculator = serviceProvider.GetRequiredService<IBillCalculator>();\n\n\tvar price = billCalculator.GetTotalPrice(orders);\n\tConsole.WriteLine($\"Total bill is: {price} - calculated with {nameof(StartupDI)}\");\n}\n```\n\n\n## Pro's and cons with the Microsoft DI\n\n**Pro** Simple to use and default setup for ASP.NET WebApi nowadays.\nTherefore, nearly any major framework is compatible with the\n`Microsoft.Extensions.DependencyInjection` NuGet.\nThis circumstance makes this option very popular and well-known.\n\n**Con** A clear con is that when using this DI-container,\nit is not possible to change the strategy decision after\nthe `IServiceProvider` was built, since Microsoft uses\na two-phased approach (which makes the dependency resolution very fast).\n\n![The two-phased DI-container from microsoft](./di-lifetime.png)\n\nAs a result, it's bad for long-running services, but perfectly fine\nfor short-lived programs like CLIs.\n\n## Summary\n\n> **Remark**: The full code is available at [GitHub](https://github.com/davidkroell/davidkroell.com/tree/main/content/blogposts/2021/strategy-design-pattern-with-di/src)\n\nWorks fine if it is a short-lived application with decisions only made once.\nOtherwise the \"default\" implementation works too, as well.\n\nWhen using other DI-Containers it is still possible to change service registrations\nduring runtime which is another potential design.\n\nAs a third option it's also possible to combine the\nclassic implementation with DI so the Context object is\nnot responsible for the strategy instance creation;\nbut the strategy client still goes through the context object.\n\nAs you can see there is no one-size-fits-all solution \nand as always you have to decide on your own which\napproach is better for your particular use case.\n","html":"<p>The strategy pattern is a behavioral design pattern which\nlets you select an algorithm at runtime.\nRather than implementing it directly, you will end up having multiple code parts\nwith the same interface, which are completely interchangeable.\nThis design pattern was invented by the famous GoF back in the ‘90.</p>\n<p>In this article I’d like to show a different implementation of it\nusing dependency injection and discuss the pros and cons\nin contrast to the “classic” implementation.</p>\n<h3>Outline</h3>\n<ul>\n<li>What is the strategy design pattern?</li>\n<li>What are the usages of it?</li>\n<li>How to implement it in a classic way</li>\n<li>How to implement it with dependency injection</li>\n</ul>\n<blockquote>\n<p><strong>Remark</strong>: The full code is available at <a href=\"https://github.com/davidkroell/davidkroell.com/tree/main/content/blogposts/2021/strategy-design-pattern-with-di/src\">GitHub</a></p>\n</blockquote>\n<h2>What is the strategy design pattern?</h2>\n<p>Imagine you are running a restaurant which provides service at the tables\nand also meals for delivery.\nAs a result, you have different efforts\nand costs depending on where your customer likes to eat.</p>\n<p>At the restaurant you have to wash dishes,\nserve plates to the table and clean them up.</p>\n<p>When a customer likes to have his menu for delivery, you\nhave to package it and deliver it to your customers house.</p>\n<p>Therefore, you maybe have two different pricing policies:</p>\n<ul>\n<li>Eating at the restaurant</li>\n<li>Takeaway and delivery</li>\n<li>… maybe many more in the future</li>\n</ul>\n<p>This is a perfect use case for the strategy design pattern.</p>\n<blockquote>\n<p>You can find a more detailed explanation of the strategy design pattern -\nalso with examples in various languages - at <a href=\"https://refactoring.guru/\">https://refactoring.guru/</a>.\nThere are also other design patterns explained in much detail at this site.\nI totally recommend it to everyone to give it a try.</p>\n</blockquote>\n<h2>Implementation without DI</h2>\n<p>Let me quickly break down this design pattern in\nit’s parts so that cou can more easily understand it.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e8e8e71066de3b51f7282ed0150c7afe/d8f62/strategy-flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.621621621621614%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABmElEQVQoz4WSW1OjQBCF8/9/kGu5+7BaqxVvay7mIglBSEiUlCQkwAADfNvMGnUtq7apr5iHmVN9+nSrrmu+oild1gzmGUO/YLgoGPk5KivQukGTqYxZd8H0zmPameP0l7Ro3n7gs+B4WWA9aR5W2vx3cUoURYbtJmJ0ZXN6dGGY3Lm0mqfVobPmexX9K1iJoGYa1EwanktyXXGo5trSDvDtZ8NyFtCq1vewsSB8oH4Ryuxw3TTddxOux2uuRgEDLzFdvwlWNYEXErgha29jzi01+UHQOyG8/07mnBMGCx5dj9nMxpsvZIaK/mNMz9nLDDP2sRK72zfLw0ubs6M2Z9/aTH6LZe2dk7mX5F6b0r8hT7coGbZSKUmacWu9cHIx4vjXgI69IS8qdFFQSDB5luMMfKyOY3CHEkqtEyhTGViCOfNuSRyZZA9YKxH6YLm5Gj5F7NaJkBKuIkn5U72HUr+G0qRcCaVJOVW5rIuS9VGkiTIrc/2zy81pD6fnS4f/2cN/16YgFpEkjomFXbRnfDsTsa5h2nH5AyMXqURYsi85AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The strategy design pattern flow\"\n        title=\"The strategy design pattern flow\"\n        src=\"/static/e8e8e71066de3b51f7282ed0150c7afe/fcda8/strategy-flow.png\"\n        srcset=\"/static/e8e8e71066de3b51f7282ed0150c7afe/12f09/strategy-flow.png 148w,\n/static/e8e8e71066de3b51f7282ed0150c7afe/e4a3f/strategy-flow.png 295w,\n/static/e8e8e71066de3b51f7282ed0150c7afe/fcda8/strategy-flow.png 590w,\n/static/e8e8e71066de3b51f7282ed0150c7afe/d8f62/strategy-flow.png 601w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Context object</p>\n<ul>\n<li>Holds a reference to all the strategies</li>\n<li>Executes them via the same interface</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BillCalculatorContext</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">Dictionary<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> IBillCalculator<span class=\"token punctuation\">></span></span> _strategies<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token function\">BillCalculatorContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BillCalculatorRestaurantStrategy</span> restaurantStrategy<span class=\"token punctuation\">,</span>\n\t\t\t\t\t\t\t\t <span class=\"token class-name\">BillCalculatorDeliveryStrategy</span> deliveryStrategy<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// all the available strategies</span>\n\t\t_strategies <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Dictionary<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">,</span> IBillCalculator<span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token punctuation\">{</span><span class=\"token string\">\"restaurant\"</span><span class=\"token punctuation\">,</span> restaurantStrategy<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">{</span><span class=\"token string\">\"delivery\"</span><span class=\"token punctuation\">,</span> deliveryStrategy<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">decimal</span></span> <span class=\"token function\">GetTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> strategy<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ICollection<span class=\"token punctuation\">&lt;</span>Order<span class=\"token punctuation\">></span></span> orders<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>_strategies<span class=\"token punctuation\">.</span><span class=\"token function\">TryGetValue</span><span class=\"token punctuation\">(</span>strategy<span class=\"token punctuation\">,</span> <span class=\"token keyword\">out</span> <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> billCalculator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token comment\">// the call to the strategy</span>\n\t\t\t<span class=\"token keyword\">return</span> billCalculator<span class=\"token punctuation\">.</span><span class=\"token function\">GetTotalPrice</span><span class=\"token punctuation\">(</span>orders<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">NotSupportedException</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Strategy </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">strategy</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> is not supported\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Strategy client:</p>\n<ul>\n<li>Decides which strategy to use</li>\n<li>Calls the context object</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">bool</span></span> isDelivery<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ICollection<span class=\"token punctuation\">&lt;</span>Order<span class=\"token punctuation\">></span></span> orders<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> billCalculatorContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">BillCalculatorContext</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">BillCalculatorRestaurantStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">BillCalculatorDeliveryStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> strategy <span class=\"token operator\">=</span> isDelivery\n\t\t<span class=\"token punctuation\">?</span> <span class=\"token string\">\"delivery\"</span>\n\t\t<span class=\"token punctuation\">:</span> <span class=\"token string\">\"restaurant\"</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> price <span class=\"token operator\">=</span> billCalculatorContext<span class=\"token punctuation\">.</span><span class=\"token function\">GetTotalPrice</span><span class=\"token punctuation\">(</span>strategy<span class=\"token punctuation\">,</span> orders<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tConsole<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Total bill is: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">price</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> - calculated with </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\"><span class=\"token keyword\">nameof</span><span class=\"token punctuation\">(</span>StartupClassic<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>A complete explanation with samples can be found here: <a href=\"https://refactoring.guru/design-patterns/strategy\">Strategy design pattern</a></p>\n</blockquote>\n<h2>Implementation with DI</h2>\n<blockquote>\n<p>Make sure to understand dependency injection first: <a href=\"https://dev.to/ankitutekar/dependency-injection-the-what-and-whys-240m\">https://dev.to/ankitutekar/dependency-injection-the-what-and-whys-240m</a></p>\n</blockquote>\n<p>Proceeding from the classic implementation,\nthe so-called <code class=\"language-text\">Context object</code> is now the DI-container.</p>\n<p>The strategy decision is handled via this container,\ndepending on what implementation is supplied in the configuration.</p>\n<p>When someone resolves the desired interface you automatically get\nthe correct implementation.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token comment\">// decision is made based on the value of isDelivery</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">bool</span></span> isDelivery<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ICollection<span class=\"token punctuation\">&lt;</span>Order<span class=\"token punctuation\">></span></span> orders<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> serviceCollection <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ServiceCollection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isDelivery<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tserviceCollection<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddSingleton</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IBillCalculator<span class=\"token punctuation\">,</span> BillCalculatorDeliveryStrategy<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">else</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tserviceCollection<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddSingleton</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IBillCalculator<span class=\"token punctuation\">,</span> BillCalculatorRestaurantStrategy<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> serviceProvider <span class=\"token operator\">=</span> serviceCollection<span class=\"token punctuation\">.</span><span class=\"token function\">BuildServiceProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> billCalculator <span class=\"token operator\">=</span> serviceProvider<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetRequiredService</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IBillCalculator<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> price <span class=\"token operator\">=</span> billCalculator<span class=\"token punctuation\">.</span><span class=\"token function\">GetTotalPrice</span><span class=\"token punctuation\">(</span>orders<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tConsole<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Total bill is: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">price</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> - calculated with </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\"><span class=\"token keyword\">nameof</span><span class=\"token punctuation\">(</span>StartupDI<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Pro’s and cons with the Microsoft DI</h2>\n<p><strong>Pro</strong> Simple to use and default setup for ASP.NET WebApi nowadays.\nTherefore, nearly any major framework is compatible with the\n<code class=\"language-text\">Microsoft.Extensions.DependencyInjection</code> NuGet.\nThis circumstance makes this option very popular and well-known.</p>\n<p><strong>Con</strong> A clear con is that when using this DI-container,\nit is not possible to change the strategy decision after\nthe <code class=\"language-text\">IServiceProvider</code> was built, since Microsoft uses\na two-phased approach (which makes the dependency resolution very fast).</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 451px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/96d215cb5211725cf2462d23878a26a3/38070/di-lifetime.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.405405405405407%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABMElEQVQY042R2W6DMBRE+f+/alN1yR5C1PShBAwhYQlLTBYg+NSQtupjRxrN2Lr3emwbc+fMenfjPbiz86ao2CWSUh5J05Q8z8myjDRLORaSTWAz88dYe5PlftHT0px4QwzLu/C6Cnhb7Xixtj1Np0ReQR4LHNfF9zy22y2+7xNHCXERMfdmPK0GDKwBj8sHXtbPmMEcw3SvLDZSs+w5+yxYehW2F3E5SU51TTudUuuhnb+eL0R5yNQbM7JHjDcjrUMmzrhPbbixvl7e4oRnPkTGvlCIpKIor6j2xk0pVBzTliVN2+o9RXmRuKmNXwjcwwaROfi5wDnYGKDocGsa/WaSOxT/hdQ9Td38ro1WnxrpBGEY9pokB+rvAtWl+9E/vkNVVcS6XghBEAT9x3WzvgB2gMMhvnSrrAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The two-phased DI-container from microsoft\"\n        title=\"The two-phased DI-container from microsoft\"\n        src=\"/static/96d215cb5211725cf2462d23878a26a3/38070/di-lifetime.png\"\n        srcset=\"/static/96d215cb5211725cf2462d23878a26a3/12f09/di-lifetime.png 148w,\n/static/96d215cb5211725cf2462d23878a26a3/e4a3f/di-lifetime.png 295w,\n/static/96d215cb5211725cf2462d23878a26a3/38070/di-lifetime.png 451w\"\n        sizes=\"(max-width: 451px) 100vw, 451px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As a result, it’s bad for long-running services, but perfectly fine\nfor short-lived programs like CLIs.</p>\n<h2>Summary</h2>\n<blockquote>\n<p><strong>Remark</strong>: The full code is available at <a href=\"https://github.com/davidkroell/davidkroell.com/tree/main/content/blogposts/2021/strategy-design-pattern-with-di/src\">GitHub</a></p>\n</blockquote>\n<p>Works fine if it is a short-lived application with decisions only made once.\nOtherwise the “default” implementation works too, as well.</p>\n<p>When using other DI-Containers it is still possible to change service registrations\nduring runtime which is another potential design.</p>\n<p>As a third option it’s also possible to combine the\nclassic implementation with DI so the Context object is\nnot responsible for the strategy instance creation;\nbut the strategy client still goes through the context object.</p>\n<p>As you can see there is no one-size-fits-all solution\nand as always you have to decide on your own which\napproach is better for your particular use case.</p>","timeToRead":4,"fields":{"slug":"/blog/2021/strategy-design-pattern-with-di/"},"frontmatter":{"title":"Strategy Design Pattern with Dependency Injection","date":"September 21, 2021","description":"Strategy design pattern implemented in C# using a classic way and with dependency injection - comparing both solutions","image":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwAE/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAATKWgrPUf//EABoQAAICAwAAAAAAAAAAAAAAAAECABEDIkP/2gAIAQEAAQUCd2ywpqSUham5VP/EABYRAQEBAAAAAAAAAAAAAAAAAAIQEf/aAAgBAwEBPwEnZ//EABgRAAIDAAAAAAAAAAAAAAAAAAACERIh/9oACAECAQE/AWauEn//xAAbEAACAgMBAAAAAAAAAAAAAAAAAREhAhASYf/aAAgBAQAGPwKZoXTnxEKijF6//8QAGxAAAwEAAwEAAAAAAAAAAAAAAAERITFRcYH/2gAIAQEAAT8ha4+yLcoNqtOkSVUk5Jobf0aNn//aAAwDAQACAAMAAAAQfx//xAAXEQADAQAAAAAAAAAAAAAAAAAAARFR/9oACAEDAQE/EGW8Jp//xAAYEQACAwAAAAAAAAAAAAAAAAABEBEhQf/aAAgBAgEBPxAEC2k//8QAHRABAAICAgMAAAAAAAAAAAAAAQARITFBUWGBkf/aAAgBAQABPxCvKA3RCDkLrI+18ES7zNEogNanN9BMkUicH7ESmlJ//9k=","aspectRatio":1.5037593984962405,"src":"/static/0da54ac82831889f4619e22314aa06ca/2f1b1/jeshoots-com-fzOITuS1DIQ-unsplash.jpg","srcSet":"/static/0da54ac82831889f4619e22314aa06ca/fd013/jeshoots-com-fzOITuS1DIQ-unsplash.jpg 200w,\n/static/0da54ac82831889f4619e22314aa06ca/25252/jeshoots-com-fzOITuS1DIQ-unsplash.jpg 400w,\n/static/0da54ac82831889f4619e22314aa06ca/2f1b1/jeshoots-com-fzOITuS1DIQ-unsplash.jpg 800w,\n/static/0da54ac82831889f4619e22314aa06ca/0ff54/jeshoots-com-fzOITuS1DIQ-unsplash.jpg 1200w,\n/static/0da54ac82831889f4619e22314aa06ca/06655/jeshoots-com-fzOITuS1DIQ-unsplash.jpg 1600w,\n/static/0da54ac82831889f4619e22314aa06ca/097fa/jeshoots-com-fzOITuS1DIQ-unsplash.jpg 1920w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{"slug":"/blog/2021/strategy-design-pattern-with-di/","previous":{"fields":{"slug":"/blog/2021/zero-to-hero-containerizing-dotnet-5-webapis/"},"frontmatter":{"title":"Zero to Hero: Containerizing .NET 5.0 WebApis","categories":["programming"]}},"next":{"fields":{"slug":"/blog/2021/homemade-di-the-hows-and-whys-of-dependency-injection/"},"frontmatter":{"title":"Homemade DI: The How's and Why's of Dependency Injection (in dotnet)","categories":["programming"]}}}},"staticQueryHashes":["143701507","3649515864"]}