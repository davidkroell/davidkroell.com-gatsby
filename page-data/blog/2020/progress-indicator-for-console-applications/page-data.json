{"componentChunkName":"component---src-templates-blogs-post-js","path":"/blog/2020/progress-indicator-for-console-applications/","result":{"data":{"site":{"siteMetadata":{"title":"David Kröll"}},"markdownRemark":{"id":"77036616-7c53-5e56-b12c-1cc216fbc34d","excerpt":"Every piece of software should inform the user about it’s current state and progress. For longer-lasting operations it’s sometimes very…","rawMarkdownBody":"\nEvery piece of software should inform the user about it's current state and progress. For longer-lasting operations it's sometimes very difficult to evaluate the level of completion.\n\nWhether it can also be impossible, most of the time it's not worth the complexity.\n\nSo I would like to show you a dead-simple but very effective way to tell the user that the app is still running but it will take some time.\nThe solution below is impressively easy but works very well.\nHence the simplicity it is almost always worth to make use of this approach.\n\n## Desired state\n\nSince we would like to make it as simple as possible, we do not want to report any remaining time or percentage of completion.\nJust print anything on the screen which should tell that something is happening in the background.\nTaking the requirements above into consideration, something like a repeated printing of dots `.` would be just fine.\n\nIt would then somehow look like this:\n\n```shell\nDoing long lasting operation...\nFinished!\n```\n\nWhere dots get appended to the line as time flies and finally, after the operation is complete, `Finished!` is printed.\n\n## Implementation\n\nI'll describe it here for C# and Go.\n\nIn a C# console application, you can use the following code:\n\n```csharp\nConsole.Write(\"Doing long lasting operation\");\n\nvar cts = new CancellationTokenSource();\n\nvar dotPrinting = new Task(() =>\n{\n\twhile (true)\n\t{\n\t\tConsole.Write('.');\n\t\tThread.Sleep(500);\n\t}\n\n}, cts.Token);\ndotPrinting.Start();\n\n// doing work which takes some time\nThread.Sleep(4000);\ncts.Cancel(); // stop the dot-printing task\n\nConsole.WriteLine(\"\\nFinished!\");\n```\n\nNote the difference between `Console.Write()` and `Console.WriteLine()` here, for appending to the same line and writing to a new one.\nWhen the `Finished!` output gets printed, a `\\n` has to be added before to start on a new line.\n\nIt could also be implemented the other way round, with the work in the separate Task and the dot-printing on 'main thread'.\nThis would also make it possible to cancel the worker by console input or something like that.\nIn order to achieve this, a `CancellationTokenSource` would have to be added.\n\n```csharp\nConsole.Write(\"Doing long lasting operation - now inside the Task\");\n\nvar work = new Task(() =>\n{\n\t// doing work which takes some time\n\tThread.Sleep(4000);\n});\nwork.Start();\n\n// check for task completion\n// or some console input to cancel the work\nwhile (!work.IsCompleted)\n{\n\tConsole.Write('.');\n\tThread.Sleep(500);\n}\n\nConsole.WriteLine(\"\\nFinished!\");\n```\n\nIn Golang, the following code would do the same as above:\n\n```go\nfmt.Print(\"Doing long lasting operation\")\ncloser := make(chan struct{})\n\n// start a new goroutine\ngo func() {\n\t// endless loop\n\tfor {\n\t\tselect {\n\t\t// either wait 500 milliseconds and print a dot\n\t\tcase <-time.Tick(500 * time.Millisecond):\n\t\t\tfmt.Print(\".\")\n\t\t// or return the goroutine\n\t\tcase <-closer:\n\t\t\treturn\n\t\t}\n\t}\n}()\n\n// doing work which takes some time\ntime.Sleep(4 * time.Second)\n\n// make the goroutine return and therefore stop printing dots\n// in this case the return statement in the receiving goroutine may not be reached,\n// since the main goroutine eventually exits faster\ncloser <- struct{}{}\n\nfmt.Println(\"\\nFinished!\")\n```\n\nWhen you think of cancellation, in C#, one could wait for console input and then cancel the background task.\nCompared to C# tasks, cancelling goroutines explicitely is not possible.\nWhen the use case allows it, you may however split your work into a loop and introduce channels using the `select` statement.\nWhether it is a good decision depends of course on the use case.\n","html":"<p>Every piece of software should inform the user about it’s current state and progress. For longer-lasting operations it’s sometimes very difficult to evaluate the level of completion.</p>\n<p>Whether it can also be impossible, most of the time it’s not worth the complexity.</p>\n<p>So I would like to show you a dead-simple but very effective way to tell the user that the app is still running but it will take some time.\nThe solution below is impressively easy but works very well.\nHence the simplicity it is almost always worth to make use of this approach.</p>\n<h2>Desired state</h2>\n<p>Since we would like to make it as simple as possible, we do not want to report any remaining time or percentage of completion.\nJust print anything on the screen which should tell that something is happening in the background.\nTaking the requirements above into consideration, something like a repeated printing of dots <code class=\"language-text\">.</code> would be just fine.</p>\n<p>It would then somehow look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">Doing long lasting operation<span class=\"token punctuation\">..</span>.\nFinished<span class=\"token operator\">!</span></code></pre></div>\n<p>Where dots get appended to the line as time flies and finally, after the operation is complete, <code class=\"language-text\">Finished!</code> is printed.</p>\n<h2>Implementation</h2>\n<p>I’ll describe it here for C# and Go.</p>\n<p>In a C# console application, you can use the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">Console<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Doing long lasting operation\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> cts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">CancellationTokenSource</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> dotPrinting <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Task</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tConsole<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span><span class=\"token char\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tThread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> cts<span class=\"token punctuation\">.</span>Token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndotPrinting<span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// doing work which takes some time</span>\nThread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">4000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncts<span class=\"token punctuation\">.</span><span class=\"token function\">Cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// stop the dot-printing task</span>\n\nConsole<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nFinished!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Note the difference between <code class=\"language-text\">Console.Write()</code> and <code class=\"language-text\">Console.WriteLine()</code> here, for appending to the same line and writing to a new one.\nWhen the <code class=\"language-text\">Finished!</code> output gets printed, a <code class=\"language-text\">\\n</code> has to be added before to start on a new line.</p>\n<p>It could also be implemented the other way round, with the work in the separate Task and the dot-printing on ‘main thread’.\nThis would also make it possible to cancel the worker by console input or something like that.\nIn order to achieve this, a <code class=\"language-text\">CancellationTokenSource</code> would have to be added.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">Console<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Doing long lasting operation - now inside the Task\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> work <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Task</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// doing work which takes some time</span>\n\tThread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">4000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nwork<span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// check for task completion</span>\n<span class=\"token comment\">// or some console input to cancel the work</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>work<span class=\"token punctuation\">.</span>IsCompleted<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tConsole<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span><span class=\"token char\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tThread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nConsole<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nFinished!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In Golang, the following code would do the same as above:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Doing long lasting operation\"</span><span class=\"token punctuation\">)</span>\ncloser <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> <span class=\"token keyword\">struct</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// start a new goroutine</span>\n<span class=\"token keyword\">go</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// endless loop</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">select</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// either wait 500 milliseconds and print a dot</span>\n\t\t<span class=\"token keyword\">case</span> <span class=\"token operator\">&lt;-</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">Tick</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span> <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span>Millisecond<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token comment\">// or return the goroutine</span>\n\t\t<span class=\"token keyword\">case</span> <span class=\"token operator\">&lt;-</span>closer<span class=\"token punctuation\">:</span>\n\t\t\t<span class=\"token keyword\">return</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// doing work which takes some time</span>\ntime<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// make the goroutine return and therefore stop printing dots</span>\n<span class=\"token comment\">// in this case the return statement in the receiving goroutine may not be reached,</span>\n<span class=\"token comment\">// since the main goroutine eventually exits faster</span>\ncloser <span class=\"token operator\">&lt;-</span> <span class=\"token keyword\">struct</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\nfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\nFinished!\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>When you think of cancellation, in C#, one could wait for console input and then cancel the background task.\nCompared to C# tasks, cancelling goroutines explicitely is not possible.\nWhen the use case allows it, you may however split your work into a loop and introduce channels using the <code class=\"language-text\">select</code> statement.\nWhether it is a good decision depends of course on the use case.</p>","timeToRead":2,"fields":{"slug":"/blog/2020/progress-indicator-for-console-applications/"},"frontmatter":{"title":"Progress indicator for console applications","date":"December 01, 2020","description":"Some thoughts about progress indicators in console application. I've added implementation details for Go and C# using several approaches.","image":{"childImageSharp":{"fluid":{"base64":"data:image/webp;base64,UklGRqYAAABXRUJQVlA4IJoAAABwBACdASoUAAoAPtFUo0uoJKMhsAgBABoJagCdMoRgAISISVUDDw5yV2LQAAD+jeD/Qdkq16VxCeGjUh2ZPb79WL5qQqyekwyy92bhfwMaJjn9bDWugisUvonxtgBVuOHIJE927x9YRgC/YI/j3J0PVG34sN44AKtmm28Bd3yi2tLu9/enNqnKhUx8lkBVT97gS+KqWqIJKwQA","aspectRatio":1.9607843137254901,"src":"/static/b6f7a7c7e1e10f594833a412bdefada7/fc91b/unsplash-7_kRuX1hSXM.webp","srcSet":"/static/b6f7a7c7e1e10f594833a412bdefada7/6b183/unsplash-7_kRuX1hSXM.webp 200w,\n/static/b6f7a7c7e1e10f594833a412bdefada7/fc32b/unsplash-7_kRuX1hSXM.webp 400w,\n/static/b6f7a7c7e1e10f594833a412bdefada7/fc91b/unsplash-7_kRuX1hSXM.webp 600w","sizes":"(max-width: 600px) 100vw, 600px"}}}}}},"pageContext":{"slug":"/blog/2020/progress-indicator-for-console-applications/","previous":null,"next":{"fields":{"slug":"/blog/2020/custom-screensaver-for-onyx-boox-note-air/"},"frontmatter":{"title":"Custom screensaver for Onyx Boox Note Air","categories":["reading"]}}}},"staticQueryHashes":["143701507","3649515864"]}